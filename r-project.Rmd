---
title: "r-project"
author: "Riley Maher, Griffin Rubin, Katie Summers, Natalie Vadasz"
date: "Dec 8, 2020"
output: 
  html_document: 
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Group Project

```{r}
library("ggplot2")
library('dplyr')
library('tidyverse')
library('geosphere')
library("ggmap")
```

## 0. Initial Setup

### Importing Data

```{r}
# Reading in the sample CSV of rider data we made
rider_2019_sample <- read.csv('sample.csv', stringsAsFactors = TRUE)
head(rider_2019_sample)

# Reading in the weather data set
weather_data <- read.csv('NYCWeather2019.csv', stringsAsFactors = TRUE)
head(weather_data)
```

### Data Summary

```{r}
# Initial summary of rider data set
str(rider_2019_sample)
summary(rider_2019_sample)
```

```{r}
# Initial summart of weather data set
str(weather_data)
summary(rider_2019_sample)
```


### Adjusting Dates and Times in Data Sets

```{r}
# Creating columns of just month, day, and year
weather_data$DATE <- as.Date(weather_data$DATE, format = "%m/%d/%Y")
weather_data$Month <- format(weather_data$DATE, "%m")
weather_data$Day <- format(weather_data$DATE, "%d")
weather_data$Year <- format(weather_data$DATE, "%Y")
```

```{r}
# Creating columns of just month, day, and year
rider_2019_sample$DATE <- as.Date(rider_2019_sample$starttime, format = "%Y-%m-%d")
rider_2019_sample$Month <- format(rider_2019_sample$DATE, "%m")
rider_2019_sample$Day <- format(rider_2019_sample$DATE, "%d")
rider_2019_sample$Year <- format(rider_2019_sample$DATE, "%Y")
```

```{r}
dates <- as.POSIXct(rider_2019_sample$stoptime)
rider_2019_sample$endtime <- format(dates, format = "%H:%M")
```
Here we were able to adjust the datasets to ensure that we could splitthe data up by a number of different variable to allow us to look at rider data over the course of a numberof different weather types, dates and times. 


### Rider Age

```{r}
rider_2019_sample$age <- 2019 - as.numeric(as.character(rider_2019_sample$birth.year))
rider_2019_sample <- filter(rider_2019_sample, age <= 80)
```

### Combining Data Sets

```{r}
# Combining data frames to compare data
edited_weather <- select(weather_data,
                         PRCP,
                         SNOW,
                         AWND,
                         DATE)
edited_rider <- select(rider_2019_sample, 
                       age,
                       gender,
                       usertype,
                       tripduration,
                       start.station.latitude,
                       start.station.longitude,
                       start.station.id,
                       start.station.name,
                       end.station.latitude,
                       end.station.longitude,
                       end.station.id,
                       end.station.name,
                       DATE,
                       Day,
                       Month,
                       Year,
                       endtime)

total_data = merge(edited_weather, edited_rider, by.x="DATE", by.y="DATE", all.x=TRUE)
head(total_data)
```
Using edited data sets allows us to more closely analyze 4 specific weather types along with specific rider variables. 


### Distance Between Stations

```{r}
# Distance between start and end station in Meters
total_data <- mutate(total_data, 
                            distance = distHaversine(cbind(total_data$start.station.longitude,
                                                           total_data$start.station.latitude),
                                                     cbind(total_data$end.station.longitude,
                                                           total_data$end.station.latitude)))
total_data <- filter(total_data, tripduration <= 3600)
head(total_data)
```
This data frame allows for us to successfully compare trip duration to the other varying data variables we defined above and adding it to an updated dataframe. 


## 1. Initial Data Analysis

### Gender Split in Riders

```{r}
# Reclassifying the genders
# 0=unknown, 1=male, 2=female
total_data$gender <- ifelse(total_data$gender == 0, "Unknown",
                                  ifelse(total_data$gender == 1, "Male", "Female"))

# Seeing the split of genders who rented bikes
total_data %>%
  ggplot(aes(x=gender, fill=gender)) +
  geom_bar() + theme(legend.position="none") +
  ggtitle("Bike Rental Counts by Gender")
```

From this bar graph, we can see the majority of people who rent bikes are males. Unknown are users who did not input their gender, meaning they are a mix of males, females, and other genders.

### Subscriber vs Customer for Riders

```{r}
# Seeing the split of user type who rented bikes
total_data %>%
  ggplot(aes(x=usertype, fill=usertype)) +
  geom_bar() +
  theme(legend.position="none") + 
  ggtitle("Bike Rental Counts by User Type")
```

The majority of bike renters are subscribers. This make sense as the subscribers probably use the bikes as everyday transportation and a subscription service is probably cheaper than renting a bike each time. Customers are probably people who just want to enjoy a bike ride once in a while or tourists, where a subscription service wouldn't make sense.

### Trip Duration

```{r}
# Range of all bike rides
trip_duration_stats <- filter(total_data) %>%
# min range of tripduration  
  summarise(duration_range_min = min(tripduration, na.rm=TRUE), 
# max range of tripduration
            duration_range_max = max(tripduration, na.rm=TRUE), 
# average length of bike ride
            duration_mean = mean(tripduration, na.rm=TRUE), 
# standard deviation of bike ride
            duration_sd = sd(tripduration, na.rm=TRUE))
```

## 2. Ride History Pattern Analysis

### Speed of Rider Demographics

```{r}
# Speed of the rider
total_data$speed <- total_data$distance/total_data$tripduration

# Average speed of all riders
all_ride <- total_data %>%
  summarise(average_speed = mean(speed))

# Average speed of young riders
young_ride <- total_data %>%
  filter(age <= 45) %>%
  summarise(young_average = mean(speed))

# Average speed of old riders
old_ride <- total_data %>%
  filter(age >= 65) %>%
  summarise(old_average = mean(speed))

# Average speed of female riders
fem_ride <- total_data %>%
  filter(gender == "Female") %>%
  summarise(female_average = mean(speed))

# Average speed of male riders
male_ride <- total_data %>%
  filter(gender == "Male") %>%
  summarise(male_average = mean(speed))

# Average speed of subscribers
sub_ride <- total_data %>%
  filter(usertype == "Customer") %>%
  summarise(customer_average = mean(speed))

# Average speed of customers
cust_ride <- total_data %>%
  filter(usertype == "Subscriber") %>%
  summarise(subscriber_average = mean(speed))

cbind(all_ride, 
young_ride, 
old_ride, 
fem_ride, 
male_ride, 
sub_ride, 
cust_ride)
```
By combining all of our variables into one dataframe here, we can compare speeds based on different classification of customers. Here we can see that the average speed of any bike rider is 2.462 with young riders averaging above this along wth male riders. The subscriber average is also significantly higher than customer average.  

### Speed of Riders Affected by Weather

```{r}
# Speed affected by rain
rain_speed <- total_data %>%
  filter(PRCP > 0, SNOW == 0) %>%
  summarise(rain_average = mean(speed))

# Speed affected by snow
snow_speed <- total_data %>%
  filter(SNOW > 0) %>%
  summarise(snow_average = mean(speed))

# Speed affected by wind
wind_speed <- total_data %>%
  filter(PRCP == 0, SNOW == 0, AWND > 0) %>%
  summarise(wind_average = mean(speed))

cbind(rain_speed, snow_speed, wind_speed)
```
Combining this data into one datafram allows us to see that wind affects bike speed more than rain or snow. Interestingly enough, snow actually still maintains the fastest speed for bikers at 2.5

```{r}
# Scatter Plot of speed by age
total_data %>%
  ggplot(aes(x = age, y = speed, colour = gender)) +
  geom_point(alpha = .4, size = 1.5) +
  scale_colour_manual(name = 'Gender',
                      values = setNames(c('blue','magenta', 'dark green'),
                                        c('Male', 'Female', 'Unknown'))) +
  geom_smooth(method='lm', colour = 'black') +
  facet_wrap(~gender)  + # make a plot per gender. look up facet_wrap for other fun ways to do this 
  labs(title="Average Speed of Riders by Age", x="Age", y="Speed")
```

```{r}
# Boxplot of speed by gender
total_data %>%
  ggplot(aes(x = gender, y = speed, colour = gender)) +
  geom_boxplot(outlier.colour = 'red') +
  scale_colour_manual(name = 'Gender',
                      values = setNames(c('blue','magenta', 'dark green'),
                                        c('Male', 'Female', 'Unknown'))) +
  labs(title="Speed of Riders by Gender", x="Gender", y="Speed")
```

From the scatter plots, we can see that all genders saw a decrease in speed as riders got older. The drop off was most steep for the Unkown gender group, but since Unknown is a mix of all genders, it's hard to make any analyses for the group. Males had a steeper decline in speed as they got older than Females, but from the box plots, we can see that Males were faster than Females on average.

```{r}
# Boxplot of speed by customer type
total_data %>%
  ggplot(aes(x = usertype, y = speed, colour = usertype)) +
  geom_boxplot(outlier.colour = 'red') +
  scale_colour_manual(name = 'User Type',
                      values = setNames(c('purple', 'orange'),
                                        c('Subscriber', 'Customer'))) +
  labs(title="Speed of Riders by Customer Type", x="Customer Type", y="Speed")
```

From these box plots, we see that Subscribers ride substantially faster than Customers. This could be because Subscribers use the bike for important purposes like going to work everyday, while Customers are most likely tourists or people riding for leisure who just want to take their time riding through the city.

### Start Location Preferences

```{r}
top_height <- max(total_data$start.station.latitude) - min(total_data$start.station.latitude)
top_width <- max(total_data$start.station.longitude) - min(total_data$start.station.longitude)
top_borders <- c(bottom  = min(total_data$start.station.latitude)  - 0.1 * top_height,
                 top     = max(total_data$start.station.latitude)  + 0.1 * top_height,
                 left    = min(total_data$start.station.longitude) - 0.2 * top_width,
                 right   = max(total_data$start.station.longitude) + 0.2 * top_width)

start <- get_stamenmap(top_borders, zoom = 12, maptype = "toner-lite")
start_map <- ggmap(start, extent = "device", legend = "topright")

start_map + stat_density2d(
aes(x = start.station.longitude, y = start.station.latitude, fill = ..level.., alpha = ..level..,), size = 2, bins = 10, data = total_data, geom = "polygon",  na.rm=TRUE,
) + labs( fill = "Density", title = "Start Location Density") + guides(alpha = F)

```

This graph shows that most bike trips in 2019 start in the center of NYC, with relatively few in the boroughs by comparison.

### Start Locations by Day of Week

```{r}
# convert dates to weekdays
total_data$day_of_week = weekdays(total_data$DATE)

start_map +
stat_density2d(
aes(x = start.station.longitude, y = start.station.latitude, fill = ..level.., alpha = ..level..),
size =2, bins = 10, geom = "polygon", data = total_data) + 
guides(alpha = F) + labs(fill = "Density", title = "Start Location Density by Day of Week") +
scale_fill_gradient(low = "yellow", high = "red") +
facet_wrap(~ day_of_week) + 
theme(legend.position = "right")

```

From these charts, we can see that the Saturday and Sunday location densities are slightly more spread than the weekdays, suggesting that the weekend trips are less concentrated in the inner city, albeit still focused in Manhattan. 

### Start Locations by User Type

```{r}
start_map +
stat_density2d(
aes(x = start.station.longitude, y = start.station.latitude, fill = ..level.., alpha = ..level..),
size =2, bins = 10, geom = "polygon", data = total_data) + 
guides(alpha = F) + labs(fill = "Density", title = "Start Location Density by User Type") +
scale_fill_gradient(low = "yellow", high = "red") +
facet_wrap(~ usertype) + 
theme(legend.position = "right")
```

This graph shows that there is larger focus on downtown start locations for Subscribers, whereas Customers are spread out along Manhattan and are present in the boroughs as well.

### Start Locations by Trip Duration

```{r}
# Creating a data frame where trip duration is one SD and above
one_sd_above <- as.numeric(trip_duration_stats[1, 3]) + as.numeric(trip_duration_stats[1, 4])
sd_above_data <- total_data %>%
    filter(trip_duration_stats[1, 3] <= tripduration, tripduration <= one_sd_above)

# Creating a data frame where trip duration is one SD and below
one_sd_below <- as.numeric(trip_duration_stats[1, 3]) - as.numeric(trip_duration_stats[1, 4])
sd_below_data <- total_data %>%
    filter(one_sd_below <= tripduration, tripduration <= trip_duration_stats[1, 3])

# Map with total riders trip duration
ggmap(start) +
  geom_point(data = total_data, mapping = aes(x = start.station.longitude, y = start.station.latitude,
                                        col = tripduration)) +
  scale_color_gradient(low = "yellow", high = "red") +
  labs(title = "Start Location by Trip Duration")

# Map with trip duration one SD above
ggmap(start) +
  geom_point(data = sd_above_data, mapping = aes(x = start.station.longitude, y = start.station.latitude,
                                        col = tripduration)) +
  scale_color_gradient(low = "yellow", high = "red") +
  labs(title = "Start Location by Trip Duration One SD Above Mean")

# Map with trip duration one SD below
ggmap(start) +
  geom_point(data = sd_below_data, mapping = aes(x = start.station.longitude, y = start.station.latitude,
                                        col = tripduration)) +
  scale_color_gradient(low = "yellow", high = "red") +
  labs(title = "Start Location by Trip Duration One SD Below Mean")
```

These graphs allow us to pinpoint how long riders are riding for depending on their start location. The edges of the city tend to have higher red dots for the trip duration one SD below the mean and the inner part of the city has higher red dots for th trip duration one SD above the mean; this could show that people who are on the outskirts of the city don't have to travel as far as those in the heart of the city.

### End Location Preferences

```{r}
# Creating a data frame where riders rented bikes in the morning
morning <- total_data %>%
  filter(endtime >= "07:00", endtime <= "12:00")

# Creating a data frame where riders rented bikes in the afternoon
afternoon <- total_data %>%
  filter(endtime > "12:00", endtime <= "16:00")

# Creating a data frame where riders rented bikes in the night
night <- total_data %>%
  filter(endtime > "16:00", endtime <= "20:00")

end <- get_stamenmap(top_borders, zoom = 12, maptype = "toner-lite")
end_map <- ggmap(end, extent = "device", legend = "topright")

#Map of the morning riders
morning_map <- end_map + stat_density2d(
  aes(x = end.station.longitude,
      y = end.station.latitude,
      fill = ..level..,
      alpha = ..level..),
  size = 1,
  bins = 5,
  data = morning,
  geom = "polygon") +
  labs(fill = "Density", title = "Morning Riders Map")

#Map of the afternoon riders
afternoon_map <- end_map + stat_density2d(
  aes(x = end.station.longitude,
      y = end.station.latitude,
      fill = ..level..,
      alpha = ..level..),
  size = 1,
  bins = 5,
  data = afternoon,
  geom = "polygon") +
  labs(fill = "Density", title = "Afternoon Riders Map")

#Map of the night riders
night_map <- end_map + stat_density2d(
  aes(x = end.station.longitude,
      y = end.station.latitude,
      fill = ..level..,
      alpha = ..level..),
  size = 1,
  bins = 5,
  data = night,
  geom = "polygon") +
  labs(fill = "Density", title = "Night Riders Map")

morning_map
afternoon_map
night_map
```

### End Locations by User Type

```{r}
end_map +
stat_density2d(
aes(x = end.station.longitude, y = end.station.latitude, fill = ..level.., alpha = ..level..),
size =2, bins = 10, geom = "polygon", data = total_data) + 
guides(alpha = F) + labs(fill = "Density", title = "End Location Density by Day of Week") +
scale_fill_gradient(low = "yellow", high = "red") +
facet_wrap(~ day_of_week) + 
theme(legend.position = "right")

```

We see the same pattern breakdown in the end location density as we do the start locations, suggesting that weekends have a more spread out end locations than the weekdays. 

## 3. Assymetric Traffic Analysis

### Symmetric vs. Asymmetric Traffic

```{r}
total_rides = count(total_data)
test = total_data
test$start.station.name = as.character(test$start.station.name)
test$end.station.name = as.character(test$end.station.name)
test <- test[test$start.station.name==test$end.station.name, ]
same_station = count(test)

symmetric = same_station / total_rides
asymmetric = 1 - symmetric
```

Only `r symmetric`% of rides start and end at the same station, which means that `r asymmetric`% of rides are asymmetric traffic.

### Station Popularity
```{r}
start_popularity = sort(table(total_data$start.station.name), decreasing=TRUE, na.rm=TRUE)
top10 = round(length(unique(total_data$start.station.name, na.rm=TRUE))*0.1)
top_10 = head(start_popularity, top10)
barplot(top_10)
top_starts = as.data.frame(top_10)
top_10rides = sum(top_starts$Freq)

top10_rides = top_10rides / total_rides

```

`r top10_rides` of bike rides start come from the top 10% most used station (which are:`{r} top_10`). Understanding this, it would be useful to focus on bike availability / station maintenance for the few most frequented stations, as they account for a substantial portion of traffic.

### Flow of Traffic per Station
```{r}
count_starts = as.data.frame(table(total_data$start.station.name), na.rm=TRUE)
names(count_starts) = c("station", "starts")
count_ends = as.data.frame(table(total_data$end.station.name), na.rm=TRUE)
names(count_ends) = c("station", "ends")
station_flow = as.data.frame(merge(count_starts, count_ends, by.x="station", by.y="station", all.x=TRUE, na.rm=TRUE))
station_flow$net = station_flow$starts / station_flow$ends

station_flow = na.omit(station_flow)

station_flow %>% mutate(station = fct_reorder(station, net)) %>% ggplot(aes(x=station, y=net)) + geom_bar(stat = "identity")+ geom_hline(yintercept=1, linetype="dashed", color = "red") + labs(x="Stations", y="Total Starts / Total Ends in 2019", title = "Ratio of Start and End Count by Station") + theme(axis.text.x = element_blank())


```

The chart above depicts each station's inflow/outflow of bikes in 2019. Those with a value greater than 1 show that they have a higher rate of bikes starting at their station than ending at their station. These stations would be important to target when thinking about rebalancing bikes, as they overall have more bikes leaving them then coming to them. Similarly, those with the lowest start/end ratios have more bikes ending at their station than leaving, making them prime candidates for moving their surplus to a station in more need.

### Bike Surplus and Deficit Stations

```{r}
surplus_stations = station_flow[station_flow$net < 0.75,]
deficit_stations = station_flow[station_flow$net > 1.25,]
```

Stations with surplus:  
`r surplus_stations$station `

Stations with deficit: 
`r deficit_stations$station `


## 4. Weather Analysis

### Trip Duration with Rain

```{r}
# Range of all bike rides affected by rain
total_data_rain <- filter(total_data, SNOW == 0, PRCP > 0) %>%
# min range of tripduration 
    summarise(duration_range_min = min(tripduration, na.rm=TRUE), 
# max range of tripduration
            duration_range_max = max(tripduration, na.rm=TRUE), 
# average length of bike ride affected by rain
            duration_mean = mean(tripduration, na.rm=TRUE), 
# standard deviation of bike ride affected by rain
            duration_sd = sd(tripduration, na.rm=TRUE))
```

### Trip Duration with Snow

```{r}
# Range of all bike rides affected by snow
total_data_snow <- filter(total_data, SNOW > 0) %>%
# min range of tripduration
      summarise(duration_range_min = min(tripduration, na.rm=TRUE), 
# max range of tripduration
      duration_range_max = max(tripduration, na.rm=TRUE), 
# average length of bike ride affected by snow
      duration_mean = mean(tripduration, na.rm=TRUE), 
# standard deviation of bike ride affected by snow
      duration_sd = sd(tripduration, na.rm=TRUE)) 
```

### Trip Duration with Wind

```{r}
# Range of all bike rides affected by wind
total_data_wind <- filter(total_data, SNOW == 0, PRCP == 0, AWND > 0) %>% 
# min range of tripduration
      summarise(duration_range_min = min(tripduration, na.rm=TRUE), 
# max range of tripduration
      duration_range_max = max(tripduration, na.rm=TRUE), 
# average length of bike ride affected by snow
      duration_mean = mean(tripduration, na.rm=TRUE), 
# standard deviation of bike ride affected by snow
      duration_sd = sd(tripduration, na.rm=TRUE)) 
```

```{r}
# Combine above dataframes into one dataframe for side-by-side comparison
dataframe_list = list("Total Data" = trip_duration_stats,
                      "Rain Data" = total_data_rain,
                      "Snow Data" = total_data_snow,
                      "Wind Data" = total_data_wind)
# Can also do rbind(trip_duration_stats, total_data_rain, etc) but this keeps source table names defined above
do.call(rbind, dataframe_list)
```

We set the max time at 3600 seconds, as any time after that seemed to be a bike that hadn't been properly returned to a station. The average trip time for all riders, regardless of weather effects is `r trip_duration_stats[1, 3]`. The average time for trip duration when it's raining is `r total_data_rain[1, 3]`. This is is smaller than the trip duration for all riders regardless of weather, meaning people are probably trying to get out of the rain quickly and not going on leisurely rides. The average time for trip duration when it's snowing is `r total_data_snow[1, 3]`. This is is also smaller than average trip duration for all riders, regardless of weather. This time is even shorter than people riding in the rain. This most likely indicates that people are riding for pure necessity and not for fun. The average time for trip duration when it's windy is `r total_data_wind[1, 3]`. This average time is substantially longer than ll other weather types. Most likely doesn't deter people from riding bikes, but the wind pushing against riders most likely increases their trip duration.  

### Types of Weather per Month

```{r}
# Average rain per month
total_data %>%
  filter(SNOW == 0) %>%
  group_by(Month) %>% 
  summarise(average_rain = mean(PRCP, na.rm = TRUE))
```
This chart allows us to see that April, May, June and July average the highest amounts of rain. This data falls in line with spring/early summer seasons. December actually garners the most rain per month in NY which is an interesting insight to consider since December is normally more closely associated with snow rather than rain. 

```{r}
# Average snow per month
total_data %>% 
  group_by(Month) %>% 
  summarise(average_snow = mean(SNOW, na.rm = TRUE))
```
This chart demonstrates that March actually garners the highest average of snowfall aligning with a late winter snow pileup. 

```{r}
# Average wind speed per month
total_data %>%
  group_by(Month) %>% 
  summarise(average_wind_speed = mean(AWND, na.rm = TRUE))
# mean returns NaN if all values in group (ex: jan and feb) are NA
```
October, November, and December have the highest average wind speeds which aligns with the late fall/early winter months as the weather starts to become colder. 

### Average Rain by Age

```{r}
# Trip duration by age of riders and rain amount
plot_data <- total_data %>%
  filter(SNOW == 0) %>%
  group_by(age) %>%
  summarise(mean_PRCP_by_age = mean(PRCP),
            mean_duration = mean(tripduration)) 

plot_data %>%
  ggplot(aes(x = age, y = mean_PRCP_by_age)) +
  geom_point(alpha =0.9, shape = 18, colour = "blue", size = plot_data$mean_duration/150) +
  geom_smooth(colour = "orange") 
```

### Average Wind by Age

```{r}
# Mean Wind by Age of Rider
total_data %>% 
  group_by(age) %>%
  summarise(mean_AWND_by_age = mean(AWND,na.rm = TRUE)) %>%
  ggplot(aes(x = age, y = mean_AWND_by_age)) + geom_line() + geom_smooth() 
```

## Rain Effects on Trip Duration

```{r}
# Average ride time when it's raining
total_data %>%
  filter(PRCP > 0, SNOW == 0) %>%
  summarise(prcp_duration_mean = mean(tripduration))

total_data %>% 
  filter(PRCP > 0, SNOW == 0) %>%
  ggplot(aes(x = tripduration)) + 
  geom_histogram(colour="black", fill="white") +
  geom_vline(aes(xintercept=mean(tripduration)), color="blue", linetype="dashed", size=1) +
  labs(title="Histogram of Rider Time Affected by Rain", x="Trip Duration", y="Count")
```

The distribution is skewed left in this graph. This makes sense as people will not want to be out in the rain long while riding their bike.

### Snow Effects on Trip Duration

```{r}
# Average ride time when it's snowing
total_data %>%
  filter(SNOW > 0) %>%
  summarise(snow_duration_mean = mean(tripduration))

total_data %>% 
  filter(SNOW > 0) %>%
  ggplot(aes(x = tripduration)) + 
  geom_histogram(colour="black", fill="white") +
  geom_vline(aes(xintercept=mean(tripduration)), color="blue", linetype="dashed", size=1) +
  labs(title="Histogram of Rider Time Affected by Snow", x="Trip Duration", y="Count")
```

The distribution is still skewed left, but we can see that even more bike rides are shorter because fewer people want to be riding a bike in the snow.

### Wind Effects on Trip Duration

```{r}
# Average ride time when it's windy
total_data %>%
  filter(SNOW == 0, PRCP == 0, AWND > 0) %>%
  summarise(wind_duration_mean = mean(tripduration))

total_data %>% 
  filter(SNOW == 0, PRCP == 0, AWND > 0) %>%
  ggplot(aes(x = tripduration)) + 
  geom_histogram(colour="black", fill="white") +
  geom_vline(aes(xintercept=mean(tripduration)), color="blue", linetype="dashed", size=1) +
  labs(title="Histogram of Rider Time Affected by Wind", x="Trip Duration", y="Count")
```

The distribution is still skewed left, but the time it takes to complete a bike ride has actually gone up. This may be because the wind doesn't deter them from riding bikes, but it does increase their ride time from the wind slowing them down.

### Weather Effects on Number of Rides over Average Ride Time

```{r}
# Number of rides over average time sin weather effects
ride_num <- total_data %>%
  filter(tripduration > trip_duration_stats[1,3]) %>%
  summarise(num_rides = n())
ride_num

# Number of rides over average time with rain
rain_num <- total_data %>%
  filter(SNOW == 0, PRCP > 0, tripduration > trip_duration_stats[1,3]) %>%
  summarise(num_rides_greater_avg_rain = n())
rain_num

# Number of rides over average time with snow
snow_num <- total_data %>%
  filter(SNOW > 0, tripduration > trip_duration_stats[1,3]) %>%
  summarise(num_rides_greater_avg_snow = n())
snow_num

# Number of rides over average time with wind
wind_num <- total_data %>%
  filter(AWND > 0, tripduration > trip_duration_stats[1,3]) %>%
  summarise(num_rides_greater_avg_wind = n())
wind_num


cbind(ride_num, rain_num, snow_num, wind_num)
```
Finally, this data frame allows us to better analyze the effect of the number of rides based on different weather affects. The average number of rides is greatest when the weather is windy and expectedly lowest when it is snowing. 
